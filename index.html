<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">

<title>The DIY Decider ‚Äî Should You DIY or Hire a Pro?</title>
<meta name="description" content="Describe your project and get straight advice from 40 years of trade experience ‚Äî DIY or call a pro.">
<link rel="canonical" href="https://thediydecider.com/" />

<meta property="og:type" content="website" />
<meta property="og:url" content="https://thediydecider.com/" />
<meta property="og:title" content="The DIY Decider ‚Äî Should You DIY or Hire a Pro?" />
<meta property="og:description" content="Describe your project and get straight advice from 40 years of trade experience." />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-THPQQG9ZB4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-THPQQG9ZB4');
</script>

<link href="https://fonts.googleapis.com/css2?family=Anton&family=Archivo+Black&family=Barlow:wght@500;600;700;800;900&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

:root {
  --bg-dark: #1c1917;
  --rust: #c0392b;
  --rust-dark: #991b1b;
  --caution: #facc15;
  --text-light: #fafaf9;
  --text-muted: #a8a29e;
  --card-bg: #292524;
  --green: #22c55e;
  --red: #ef4444;
  --radius: 20px;
}

html, body { min-height: 100%; min-height: 100dvh; }

body {
  background: var(--bg-dark);
  font-family: 'Barlow', sans-serif;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}

/* NAV */
nav {
  width: 100%;
  background: var(--bg-dark);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
}

.nav-logo {
  font-family: 'Anton', sans-serif;
  font-size: 1.4rem;
  color: #fff;
  text-decoration: none;
}
.nav-logo span { color: var(--caution); }

.nav-links { display: flex; gap: 2rem; }
.nav-links a {
  font-size: 0.9rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-muted);
  text-decoration: none;
}
.nav-links a:hover, .nav-links a.active { color: var(--caution); }

/* HERO - Character + Title centered, character SMALLER */
.hero-section {
  background: linear-gradient(180deg, var(--rust) 0%, var(--rust-dark) 100%);
  padding: 1rem 1rem;
}

.hero-content {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  max-width: 450px;
  margin: 0 auto;
}

.hero-character {
  width: 75px;
  flex-shrink: 0;
}

.hero-character img {
  width: 100%;
  height: auto;
  filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
}

.hero-text {
  text-align: left;
}

.hero-text h1 {
  font-family: 'Archivo Black', sans-serif;
  font-size: clamp(1.4rem, 5vw, 2rem);
  color: white;
  line-height: 0.95;
  text-transform: uppercase;
  text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
}

.hero-text h1 span { color: var(--caution); }

.hero-text .tagline {
  font-size: 0.75rem;
  color: rgba(255,255,255,0.85);
  margin-top: 0.35rem;
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.caution-stripe {
  width: 100%;
  height: 12px;
  background: repeating-linear-gradient(-55deg, var(--caution) 0px, var(--caution) 12px, #111 12px, #111 24px);
}

/* MAIN */
.main-wrapper {
  flex: 1;
  background: var(--bg-dark);
  padding: 1.5rem 1rem 2rem;
}

.card-container {
  max-width: 500px;
  margin: 0 auto;
}

/* CARD */
.card {
  background: var(--card-bg);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
}

.card-header {
  background: #1c1917;
  padding: 0.85rem 1.25rem;
}

.card-header-label {
  font-size: 0.85rem;
  font-weight: 800;
  letter-spacing: 0.1em;
  color: var(--caution);
  text-transform: uppercase;
}

.card-body { padding: 1.25rem; }

/* INTRO */
.intro-quote {
  background: rgba(0,0,0,0.3);
  border-left: 3px solid var(--rust);
  padding: 12px 14px;
  border-radius: 0 8px 8px 0;
  margin-bottom: 16px;
  font-style: italic;
  font-size: 0.95rem;
  color: var(--text-light);
  line-height: 1.5;
}

.intro-quote strong {
  color: var(--caution);
  font-style: normal;
}

/* FORM */
.form-group { margin-bottom: 16px; }

.form-label {
  display: block;
  font-weight: 700;
  font-size: 0.9rem;
  color: var(--text-light);
  margin-bottom: 6px;
}

.form-hint {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-top: 5px;
}

.text-input {
  width: 100%;
  min-height: 90px;
  background: #1c1917;
  border: 2px solid #44403c;
  border-radius: 8px;
  padding: 12px;
  font-family: 'Barlow', sans-serif;
  font-size: 1rem;
  color: var(--text-light);
  resize: vertical;
}

.text-input:focus {
  outline: none;
  border-color: var(--rust);
}

.text-input::placeholder {
  color: var(--text-muted);
  opacity: 0.6;
}

/* Upload */
.upload-zone {
  border: 2px dashed #44403c;
  border-radius: 8px;
  padding: 14px;
  text-align: center;
  cursor: pointer;
  background: rgba(0,0,0,0.15);
}

.upload-zone:hover { border-color: var(--rust); }
.upload-zone.has-files { border-color: var(--green); border-style: solid; }

.upload-icon { font-size: 1.5rem; margin-bottom: 4px; }
.upload-text { font-weight: 600; font-size: 0.85rem; color: var(--text-light); }
.upload-hint { font-size: 0.75rem; color: var(--text-muted); margin-top: 2px; }

.file-preview {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 10px;
  justify-content: center;
}

.file-thumb-wrapper {
  position: relative;
  display: inline-block;
}

.file-thumb {
  width: 45px;
  height: 45px;
  border-radius: 4px;
  object-fit: cover;
  border: 2px solid var(--rust);
  display: block;
}

.file-delete {
  position: absolute;
  top: -6px;
  right: -6px;
  width: 18px;
  height: 18px;
  background: var(--red);
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  padding: 0;
}

.file-delete:hover {
  background: #dc2626;
  transform: scale(1.1);
}

/* Experience - 2x2 GRID */
.experience-options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.experience-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px;
  background: #1c1917;
  border: 2px solid #44403c;
  border-radius: 8px;
  cursor: pointer;
}

.experience-option:hover { border-color: var(--rust); }

.experience-option.selected {
  border-color: var(--rust);
  background: rgba(192, 57, 43, 0.15);
}

.experience-option input { display: none; }

.experience-radio {
  width: 14px;
  height: 14px;
  border: 2px solid var(--text-muted);
  border-radius: 50%;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.experience-option.selected .experience-radio {
  border-color: var(--rust);
}

.experience-option.selected .experience-radio::after {
  content: '';
  width: 6px;
  height: 6px;
  background: var(--rust);
  border-radius: 50%;
}

.experience-label {
  font-weight: 600;
  font-size: 0.85rem;
  color: var(--text-light);
}

/* Motivation - SINGLE ROW, CENTERED */
.motivation-chips {
  display: flex;
  justify-content: center;
  gap: 8px;
}

.motivation-chip {
  padding: 8px 12px;
  background: #1c1917;
  border: 2px solid #44403c;
  border-radius: 18px;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-light);
  cursor: pointer;
  white-space: nowrap;
}

.motivation-chip:hover { border-color: var(--rust); }

.motivation-chip.selected {
  border-color: var(--caution);
  background: rgba(250, 204, 21, 0.15);
  color: var(--caution);
}

/* BUTTONS */
.btn-primary {
  width: 100%;
  background: linear-gradient(135deg, var(--rust) 0%, var(--rust-dark) 100%);
  color: white;
  border: none;
  padding: 14px;
  font-family: 'Archivo Black', sans-serif;
  font-size: 1rem;
  letter-spacing: 1px;
  text-transform: uppercase;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(192, 57, 43, 0.4);
  margin-top: 8px;
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(192, 57, 43, 0.5);
}

.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-secondary {
  width: 100%;
  background: transparent;
  color: var(--text-muted);
  border: 2px solid #44403c;
  padding: 12px;
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.9rem;
  text-transform: uppercase;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 10px;
}

.btn-secondary:hover {
  border-color: var(--caution);
  color: var(--caution);
}

/* Requirements */
.validation-error {
  font-size: 0.85rem;
  color: var(--red);
  text-align: center;
  margin-top: 10px;
  padding: 10px;
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 8px;
  animation: shake 0.4s ease;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-5px); }
  40%, 80% { transform: translateX(5px); }
}

/* LOADING */
.loading-section { text-align: center; padding: 2rem 1rem; }

.loading-spinner {
  width: 45px;
  height: 45px;
  border: 4px solid #44403c;
  border-top-color: var(--caution);
  border-radius: 50%;
  margin: 0 auto 16px;
  animation: spin 1s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.loading-text { font-size: 1rem; font-weight: 600; color: var(--text-light); }
.loading-quip { font-size: 0.9rem; color: var(--text-muted); font-style: italic; margin-top: 10px; }

/* FIRST TAKE */
.situation-badge {
  display: inline-block;
  background: var(--rust);
  color: white;
  padding: 5px 12px;
  border-radius: 4px;
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.8rem;
  letter-spacing: 1px;
  margin-bottom: 14px;
}

.observations-section {
  background: rgba(0,0,0,0.25);
  border-radius: 8px;
  padding: 14px;
  margin-bottom: 16px;
}

.observations-title {
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.85rem;
  color: var(--caution);
  margin-bottom: 10px;
  text-transform: uppercase;
}

.observation {
  display: flex;
  gap: 8px;
  padding: 6px 0;
  font-size: 0.9rem;
  color: var(--text-light);
  border-bottom: 1px solid rgba(255,255,255,0.05);
  line-height: 1.5;
}

.observation:last-child { border-bottom: none; }
.observation::before { content: '‚ñ∏'; color: var(--rust); }

.first-take-quote {
  padding: 14px;
  background: linear-gradient(135deg, rgba(192,57,43,0.15) 0%, rgba(192,57,43,0.05) 100%);
  border-left: 4px solid var(--rust);
  border-radius: 0 8px 8px 0;
}

.first-take-label {
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.8rem;
  color: var(--rust);
  margin-bottom: 8px;
  text-transform: uppercase;
}

.first-take-text {
  font-size: 1rem;
  line-height: 1.6;
  color: var(--text-light);
  font-style: italic;
}

/* QUESTIONS */
.question-progress { display: flex; gap: 6px; margin-bottom: 16px; }

.progress-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
}

.progress-dot.done { background: var(--green); }
.progress-dot.active { background: var(--caution); box-shadow: 0 0 8px var(--caution); }

.question-context {
  font-size: 0.85rem;
  color: var(--text-muted);
  font-style: italic;
  margin-bottom: 10px;
  padding-left: 10px;
  border-left: 2px solid var(--rust);
}

.question-text {
  font-size: 1.05rem;
  font-weight: 600;
  color: var(--text-light);
  margin-bottom: 16px;
  line-height: 1.5;
}

.answer-btn {
  width: 100%;
  padding: 14px;
  margin-bottom: 8px;
  background: #1c1917;
  border: 2px solid #44403c;
  border-radius: 8px;
  font-family: 'Barlow', sans-serif;
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-light);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
}

.answer-btn:hover {
  border-color: var(--rust);
  background: rgba(192, 57, 43, 0.1);
}

/* VERDICT */
.verdict-header {
  padding: 20px;
  text-align: center;
  border-bottom: 3px solid var(--rust);
}

.verdict-badge {
  display: inline-block;
  padding: 8px 20px;
  border-radius: 4px;
  font-family: 'Archivo Black', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 2px;
  margin-bottom: 10px;
}

.verdict-diy { background: var(--green); color: white; }
.verdict-hire { background: var(--red); color: white; }
.verdict-hybrid { background: var(--caution); color: var(--bg-dark); }

.verdict-headline {
  font-family: 'Archivo Black', sans-serif;
  font-size: 1.3rem;
  color: var(--text-light);
  text-transform: uppercase;
}

.verdict-body { padding: 16px; }
.verdict-section { margin-bottom: 16px; }
.verdict-section:last-child { margin-bottom: 0; }

.verdict-section-title {
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.85rem;
  color: var(--caution);
  margin-bottom: 8px;
  text-transform: uppercase;
}

.verdict-section p { font-size: 0.95rem; line-height: 1.6; color: var(--text-light); }

.flags-list { list-style: none; }

.flags-list li {
  padding: 8px 0 8px 20px;
  position: relative;
  font-size: 0.9rem;
  color: var(--text-light);
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.flags-list li:last-child { border-bottom: none; }
.green-flags li::before { content: '‚úì'; position: absolute; left: 0; color: var(--green); }
.red-flags li::before { content: '‚úó'; position: absolute; left: 0; color: var(--red); }

.cost-breakdown {
  background: rgba(0,0,0,0.25);
  border-radius: 8px;
  padding: 12px;
}

.cost-row {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  font-size: 0.9rem;
}

.cost-row:last-child { border-bottom: none; }
.cost-label { color: var(--text-muted); }
.cost-value { font-weight: 700; color: var(--text-light); }

.final-word {
  padding: 14px;
  background: linear-gradient(135deg, rgba(192,57,43,0.15) 0%, rgba(192,57,43,0.05) 100%);
  border-left: 4px solid var(--rust);
  border-radius: 0 8px 8px 0;
  margin-top: 16px;
}

.final-word-label {
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.8rem;
  color: var(--rust);
  margin-bottom: 8px;
  text-transform: uppercase;
}

.final-word-text {
  font-size: 1rem;
  line-height: 1.6;
  color: var(--text-light);
  font-style: italic;
}

.hidden { display: none !important; }

/* MOBILE */
@media (max-width: 480px) {
  nav { padding: 0.8rem 1rem; }
  .nav-logo { font-size: 1.2rem; }
  .nav-links { gap: 1rem; }
  .nav-links a { font-size: 0.75rem; }
  
  .hero-section { padding: 0.75rem; }
  .hero-content { gap: 0.75rem; }
  .hero-character { width: 60px; }
  .hero-text h1 { font-size: 1.3rem; }
  .hero-text .tagline { font-size: 0.65rem; }
  
  .main-wrapper { padding: 1rem 0.75rem; }
  .card-body { padding: 1rem; }
  
  .experience-options { gap: 6px; }
  .experience-option { padding: 8px; }
  .experience-label { font-size: 0.8rem; }
  
  .motivation-chips { flex-wrap: wrap; justify-content: center; }
  .motivation-chip { padding: 6px 10px; font-size: 0.8rem; }
}
</style>
</head>
<body>

<nav>
  <a href="index.html" class="nav-logo">THE DIY <span>DECIDER</span></a>
  <div class="nav-links">
    <a href="index.html" class="active">Tool</a>
    <a href="about.html">About</a>
  </div>
</nav>

<div class="hero-section">
  <div class="hero-content">
    <div class="hero-character">
      <img src="decider.png" alt="The Decider">
    </div>
    <div class="hero-text">
      <h1>THE DIY <span>DECIDER</span></h1>
      <p class="tagline">40 Years Experience. Zero BS.</p>
    </div>
  </div>
</div>
<div class="caution-stripe"></div>

<div class="main-wrapper">
  <div class="card-container">
    
    <!-- INPUT -->
    <div id="stage-input">
      <div class="card">
        <div class="card-header">
          <span class="card-header-label">Tell Me About Your Project</span>
        </div>
        <div class="card-body">
          
          <div class="intro-quote">
            "You want the truth or you want me to blow smoke? <strong>Give me the real picture</strong> and I'll tell you straight."
          </div>
          
          <div class="form-group">
            <label class="form-label">What's the project?</label>
            <textarea class="text-input" id="project-input" placeholder="Example: Replace bathroom vanity, fix leaky faucet, install ceiling fan, build a deck..."></textarea>
            <p class="form-hint">A sentence or two is all I need.</p>
          </div>
          
          <div class="form-group">
            <label class="form-label">Got photos? (optional)</label>
            <div class="upload-zone" id="upload-zone">
              <div class="upload-icon">üì∏</div>
              <div class="upload-text">Tap to add photos</div>
              <div class="upload-hint">Show me what you're working with</div>
              <div class="file-preview" id="file-preview"></div>
            </div>
            <input type="file" id="file-input" accept="image/*" multiple hidden>
          </div>
          
          <div class="form-group">
            <label class="form-label">How handy are you?</label>
            <div class="experience-options">
              <label class="experience-option" data-value="novice">
                <input type="radio" name="experience" value="novice">
                <div class="experience-radio"></div>
                <span class="experience-label">üî∞ New to this</span>
              </label>
              <label class="experience-option" data-value="some">
                <input type="radio" name="experience" value="some">
                <div class="experience-radio"></div>
                <span class="experience-label">üîß Some experience</span>
              </label>
              <label class="experience-option" data-value="handy">
                <input type="radio" name="experience" value="handy">
                <div class="experience-radio"></div>
                <span class="experience-label">üõ†Ô∏è Pretty handy</span>
              </label>
              <label class="experience-option" data-value="experienced">
                <input type="radio" name="experience" value="experienced">
                <div class="experience-radio"></div>
                <span class="experience-label">‚ö° Experienced</span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Why DIY?</label>
            <div class="motivation-chips">
              <button type="button" class="motivation-chip" data-value="save-money">üí∞ Save money</button>
              <button type="button" class="motivation-chip" data-value="learn">üìö Learn</button>
              <button type="button" class="motivation-chip" data-value="enjoy">üòä Enjoy it</button>
              <button type="button" class="motivation-chip" data-value="timeline">‚è∞ Fast</button>
            </div>
          </div>
          
          <button class="btn-primary" id="analyze-btn">LET'S SEE WHAT WE'VE GOT ‚Üí</button>
          
          <p class="validation-error hidden" id="validation-error"></p>
        </div>
      </div>
    </div>

    <!-- LOADING -->
    <div id="stage-loading" class="hidden">
      <div class="card">
        <div class="card-body">
          <div class="loading-section">
            <div class="loading-spinner"></div>
            <p class="loading-text">Sizing up your project...</p>
            <p class="loading-quip" id="loading-quip"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- FIRST TAKE -->
    <div id="stage-first-take" class="hidden">
      <div class="card">
        <div class="card-body">
          <span class="situation-badge" id="situation-badge">PROJECT</span>
          <div class="observations-section">
            <div class="observations-title">üîç What I'm Seeing</div>
            <div id="observations-list"></div>
          </div>
          <div class="first-take-quote">
            <div class="first-take-label">üó£Ô∏è The Decider's Take</div>
            <p class="first-take-text" id="first-take-text"></p>
          </div>
        </div>
      </div>
      <button class="btn-primary" id="continue-btn">HIT ME WITH THE QUESTIONS ‚Üí</button>
    </div>

    <!-- QUESTIONS -->
    <div id="stage-questions" class="hidden">
      <div class="card">
        <div class="card-body" id="question-container"></div>
      </div>
    </div>

    <!-- VERDICT -->
    <div id="stage-verdict" class="hidden">
      <div class="card" id="verdict-card"></div>
      <button class="btn-secondary" id="start-over-btn">‚Üê NEW PROJECT</button>
    </div>

  </div>
</div>

<script>
const API_BASE_URL = '';
const LOADING_QUIPS = [
  "Checking if you're about to make a 'learning experience'...",
  "Running this through 40 years of 'I told you so'...",
  "Calculating hardware store trips...",
  "Consulting my database of DIY disasters...",
  "Seeing if YouTube can actually save you here..."
];

let uploadedFiles = [];
let selectedExperience = null;
let selectedMotivations = [];
let analysisData = null;
let currentQuestion = 0;
let answers = [];

const projectInput = document.getElementById('project-input');
const uploadZone = document.getElementById('upload-zone');
const fileInput = document.getElementById('file-input');
const filePreview = document.getElementById('file-preview');
const analyzeBtn = document.getElementById('analyze-btn');
const loadingQuip = document.getElementById('loading-quip');

// File upload
uploadZone.addEventListener('click', (e) => {
  // Don't trigger file picker if clicking delete button
  if (e.target.classList.contains('file-delete')) return;
  fileInput.click();
});

fileInput.addEventListener('change', (e) => {
  uploadedFiles = [...uploadedFiles, ...Array.from(e.target.files)];
  renderFilePreviews();
});

function renderFilePreviews() {
  filePreview.innerHTML = '';
  uploadedFiles.forEach((file, index) => {
    const wrapper = document.createElement('div');
    wrapper.className = 'file-thumb-wrapper';
    
    const img = document.createElement('img');
    img.className = 'file-thumb';
    img.src = URL.createObjectURL(file);
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'file-delete';
    deleteBtn.innerHTML = '‚úï';
    deleteBtn.type = 'button';
    deleteBtn.onclick = (e) => {
      e.stopPropagation();
      uploadedFiles.splice(index, 1);
      renderFilePreviews();
    };
    
    wrapper.appendChild(img);
    wrapper.appendChild(deleteBtn);
    filePreview.appendChild(wrapper);
  });
  uploadZone.classList.toggle('has-files', uploadedFiles.length > 0);
}

// Experience
document.querySelectorAll('.experience-option').forEach(opt => {
  opt.addEventListener('click', () => {
    document.querySelectorAll('.experience-option').forEach(o => o.classList.remove('selected'));
    opt.classList.add('selected');
    opt.querySelector('input').checked = true;
    selectedExperience = opt.dataset.value;
    hideValidationError();
  });
});

// Motivation
document.querySelectorAll('.motivation-chip').forEach(chip => {
  chip.addEventListener('click', () => {
    chip.classList.toggle('selected');
    const val = chip.dataset.value;
    if (selectedMotivations.includes(val)) {
      selectedMotivations = selectedMotivations.filter(m => m !== val);
    } else {
      selectedMotivations.push(val);
    }
    hideValidationError();
  });
});

// Validation
const validationError = document.getElementById('validation-error');
const MIN_PROJECT_LENGTH = 10;

projectInput.addEventListener('input', hideValidationError);

function hideValidationError() {
  validationError.classList.add('hidden');
  validationError.textContent = '';
}

function validateForm() {
  const projectLength = projectInput.value.trim().length;
  const errors = [];
  
  if (projectLength < MIN_PROJECT_LENGTH) {
    const needed = MIN_PROJECT_LENGTH - projectLength;
    errors.push(`Describe your project (${needed} more character${needed === 1 ? '' : 's'} needed)`);
  }
  
  if (!selectedExperience) {
    errors.push('Select your experience level');
  }
  
  if (selectedMotivations.length === 0) {
    errors.push('Pick at least one reason for DIY');
  }
  
  return errors;
}

function showValidationError(errors) {
  validationError.textContent = errors.join(' ‚Ä¢ ');
  validationError.classList.remove('hidden');
  // Re-trigger animation
  validationError.style.animation = 'none';
  validationError.offsetHeight; // Force reflow
  validationError.style.animation = null;
}

// Stages
function showStage(s) {
  ['input','loading','first-take','questions','verdict'].forEach(x => {
    document.getElementById('stage-'+x).classList.add('hidden');
  });
  document.getElementById('stage-'+s).classList.remove('hidden');
}

// Loading quips
let quipInterval;
function startQuips() {
  let i = 0;
  loadingQuip.textContent = LOADING_QUIPS[0];
  quipInterval = setInterval(() => {
    i = (i + 1) % LOADING_QUIPS.length;
    loadingQuip.textContent = LOADING_QUIPS[i];
  }, 2500);
}
function stopQuips() { clearInterval(quipInterval); }

// Analyze
analyzeBtn.addEventListener('click', async () => {
  const errors = validateForm();
  
  if (errors.length > 0) {
    showValidationError(errors);
    return;
  }
  
  showStage('loading');
  startQuips();
  
  try {
    const formData = new FormData();
    uploadedFiles.forEach(f => formData.append('files', f));
    formData.append('project', projectInput.value);
    formData.append('experience', selectedExperience);
    formData.append('motivations', JSON.stringify(selectedMotivations));
    
    const res = await fetch(API_BASE_URL + '/api/analyze', { method: 'POST', body: formData });
    if (!res.ok) throw new Error('Failed');
    
    const result = await res.json();
    analysisData = result.data;
    stopQuips();
    
    document.getElementById('situation-badge').textContent = analysisData.situation_type || 'PROJECT';
    document.getElementById('observations-list').innerHTML = analysisData.observations.map(o => `<div class="observation">${o}</div>`).join('');
    document.getElementById('first-take-text').textContent = analysisData.first_take;
    
    showStage('first-take');
  } catch (e) {
    stopQuips();
    alert('Something went wrong. Try again.');
    showStage('input');
  }
});

// Continue
document.getElementById('continue-btn').addEventListener('click', () => {
  showStage('questions');
  renderQuestion();
});

function renderQuestion() {
  if (currentQuestion >= analysisData.questions.length) {
    getVerdict();
    return;
  }
  
  const q = analysisData.questions[currentQuestion];
  document.getElementById('question-container').innerHTML = `
    <div class="question-progress">
      ${analysisData.questions.map((_, i) => `<div class="progress-dot ${i < currentQuestion ? 'done' : ''} ${i === currentQuestion ? 'active' : ''}"></div>`).join('')}
    </div>
    ${q.context ? `<p class="question-context">${q.context}</p>` : ''}
    <p class="question-text">${q.question}</p>
    <button class="answer-btn" data-answer="yes"><span>‚úì</span> Yes</button>
    <button class="answer-btn" data-answer="no"><span>‚úó</span> No</button>
  `;
  
  document.querySelectorAll('.answer-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      answers.push({ question: q.question, answer: btn.dataset.answer });
      currentQuestion++;
      renderQuestion();
    });
  });
}

async function getVerdict() {
  showStage('loading');
  startQuips();
  
  try {
    const res = await fetch(API_BASE_URL + '/api/verdict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        project: projectInput.value,
        experience: selectedExperience,
        motivations: selectedMotivations,
        situationType: analysisData.situation_type,
        observations: analysisData.observations,
        firstTake: analysisData.first_take,
        questions: analysisData.questions,
        answers
      })
    });
    
    if (!res.ok) throw new Error('Failed');
    const result = await res.json();
    stopQuips();
    
    const v = result.data;
    let vc = 'diy';
    if (v.verdict.toLowerCase().includes('pro') || v.verdict.toLowerCase().includes('hire')) vc = 'hire';
    else if (v.verdict.toLowerCase().includes('hybrid')) vc = 'hybrid';
    
    document.getElementById('verdict-card').innerHTML = `
      <div class="verdict-header">
        <div class="verdict-badge verdict-${vc}">${v.verdict}</div>
        <h2 class="verdict-headline">${v.headline}</h2>
      </div>
      <div class="verdict-body">
        <div class="verdict-section">
          <div class="verdict-section-title">üìã The Breakdown</div>
          <p>${v.breakdown}</p>
        </div>
        ${v.green_flags?.length ? `<div class="verdict-section"><div class="verdict-section-title">‚úì In Your Favor</div><ul class="flags-list green-flags">${v.green_flags.map(f=>`<li>${f}</li>`).join('')}</ul></div>` : ''}
        ${v.red_flags?.length ? `<div class="verdict-section"><div class="verdict-section-title">‚ö†Ô∏è Watch Out</div><ul class="flags-list red-flags">${v.red_flags.map(f=>`<li>${f}</li>`).join('')}</ul></div>` : ''}
        ${v.cost_estimate ? `<div class="verdict-section"><div class="verdict-section-title">üíµ Costs</div><div class="cost-breakdown"><div class="cost-row"><span class="cost-label">DIY</span><span class="cost-value">${v.cost_estimate.diy}</span></div><div class="cost-row"><span class="cost-label">Pro</span><span class="cost-value">${v.cost_estimate.pro}</span></div><div class="cost-row"><span class="cost-label">Time</span><span class="cost-value">${v.cost_estimate.time}</span></div></div></div>` : ''}
        <div class="final-word">
          <div class="final-word-label">üó£Ô∏è Final Word</div>
          <p class="final-word-text">"${v.final_word}"</p>
        </div>
      </div>
    `;
    showStage('verdict');
  } catch (e) {
    stopQuips();
    alert('Something went wrong. Try again.');
    showStage('input');
  }
}

document.getElementById('start-over-btn').addEventListener('click', () => {
  uploadedFiles = [];
  selectedExperience = null;
  selectedMotivations = [];
  analysisData = null;
  currentQuestion = 0;
  answers = [];
  filePreview.innerHTML = '';
  uploadZone.classList.remove('has-files');
  projectInput.value = '';
  document.querySelectorAll('.experience-option').forEach(o => o.classList.remove('selected'));
  document.querySelectorAll('.motivation-chip').forEach(c => c.classList.remove('selected'));
  hideValidationError();
  showStage('input');
});
</script>
</body>
</html>